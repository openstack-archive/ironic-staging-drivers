- include: root-device.yaml

- include: parted.yaml
  when: "{{ ironic.image.type | default('whole-disk-image') == 'partition' }}"

- include: download.yaml
  when: "{{ ironic.image.disk_format != 'raw' }}"

- include: write.yaml

- include: configdrive.yaml
  when: ironic.configdrive is defined

- include: grub.yaml
  when: "{{ ironic.image.type | default('whole-disk-image') == 'partition' }}"

- name: flush
  command: sync
